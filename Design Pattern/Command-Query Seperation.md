## Command-Query Seperation

> 명령과 쿼리를 분리하라.

### CQS?

프로그래밍 언어 Eiffel의 개발자 **Bertrand Meyer**가 제안한 명령형 프로그래밍의 원칙. 모든 메소드가 어떠한 작업(행동)을 수행하는 **명령**이거나, 요청에 따른 데이터를 반환하는 **쿼리**여야 하지만, **둘 모두일 수는 없다**는 것.

즉, 질문을 한다고 해서 대답이 변경되어서는 안된다는 의미. 좀 더 공적으로 말해서 메소드는 **참조 투명성**을 가지고 **부작용**이 없을 경우에만 값을 반환해야함.

### Commands & Queries

CQS를 위해서는 객체의 메소드들을 두 개의 범주로 **명확하게 구분**해야 함.

- **명령**(Commands) : **상태를 변경**하지만 결과를 반환하지 않음
- **쿼리**(Queries) : **결과를 반환**하지만 상태를 변경하지 않음

> 쿼리는 결과만 반환할 뿐, 상태를 변경하지 않으므로 **부작용**으로부터 자유로움.

> Martin Fowler는 **명령**보다 **수정자**라는 표현을 선호한다고 함.

### CQS!

CQS 원칙의 가장 중요한 아이디어는 **상태를 변경하는 메소드와 그렇지 않은 메소드를 명확하게 분리할 수 있다면 엄청나게 편리하다**는 것.

그러나 CQS를 준수해야 한다는 생각에 간단한 코드를 복잡하게 구현하고 있진 않은지 항상 주의해야 함께. 읽기 좋은 코드를 짜려고 쓰는 기법들이 오히려 코드를 복잡하게 만든다면 과감하게 포기.

CQS는 재진입성을 가졌거나 다중 스레드를 가지는 프로그램을 구현할 땐 더 복잡해질 수 있음. 스레드에 안전하지 않은 패턴으로 명령과 쿼리를 분리할 때 문제가 발생함.

### CQRS

**Command & Query Responsibility Segregation**의 약자로 CQS의 개념을 서비스 수준으로 확장한 것. 명령과 쿼리를 메소드 단위가 아니라 인터페이스 단계부터 분리하여 데이터 모델 자체를 두 개로 분리함. DDD(Domain Driven Design)의 이점을 극대화 할 수 있음.
