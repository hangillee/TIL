## Docker Compose

### Docker Compose란?

**Compose**는 다중 컨테이너로 이루어진 Docker 어플리케이션들을 정의하고 실행하기 위한 도구. 즉, 사용자가 컨테이너 기반의 플랫폼 독립적인 어플리케이션을 정의할 수 있게 만들어줌.

여기서 **어플리케이션**은 시스템 자원과 소통 채널을 적절하게 공유하며 **함께 동작해야하는 컨테이너의 집합**으로 설계된 것을 말함. 예를 들어, 웹 서버 컨테이너와 데이터베이스 컨테이너는 함께 동작해야 하는 대표적인 컨테이너 집합.

즉, **서로 다른 컨테이너들이 함께 동작해야 한다면 하나의 어플리케이션으로 정의하고 간편하게 실행**시키는 것이 Compose.

### Docker Compose 사용하기

**YAML** 파일을 사용해 어플리케이션의 서비스들을 구성하고 명령어 한 줄로 YAML에 적어둔 구성 정보대로 모든 서비스들이 생성, 시작됨.

```yaml
# compose.yml
services:
  web:
    build: .
    ports:
      - "8000:5000"
  redis:
    image: "redis:alpine"
```

```zsh
docker compose up
```

Compose는 운영, 스테이징, 개발, 테스트, CI Workflow 등의 모든 개발 환경에서 동작하며 어플리케이션의 전체 생명주기를 관리하기 위한 명령어를 가짐.

- `docker compose up` : 빌드, 재빌드, 어플리케이션 실행
  - `-d` : 백그라운드에서 어플리케이션 실행
- `docker compose run` : 일회성 명령을 포함한 어플리케이션 실행
- `docker image ls` : 로컬 이미지 목록 확인
- `docker compose ps` : 실행 중인 컨테이너 목록 확인
- `docker compose stop` : 컨테이너 정지
- `docker compose down` : 정지 후 컨테이너 및 네트워크 삭제
  - `--volumes` : 컨테이너에 할당된 볼륨도 함께 삭제

**볼륨**은 데이터베이스와 같이 컨테이너가 값을 영구적으로 저장해야하는 경우 할당해주는 공간으로, 지정해주지 않으면 컨테이너가 삭제되면 컨테이너가 관리하던 모든 데이터도 함께 삭제.

### Docker Compose 어플리케이션 구성

- services : 컨테이너 이미지와 설정을 통해 실제 실행되는 서비스
- networks : 서비스들이 서로 통신하기 위한 네트워크
- volumes : 데이터를 영구히 저장하고 공유하기 위한 파일시스템
- configs : 서비스에서 필요로하는 설정 정보
- secrets : 서비스에 제공해야하는 민감한 보안 정보
