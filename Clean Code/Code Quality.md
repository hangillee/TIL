## Code Quality

> 고품질 코드는 신뢰할 수 있고, 유지보수가 쉬우며, 버그가 적은 소프트웨어를 생산한다.

### 코드 품질이란?

**코드 품질**은 실제적인 관심 사항에 근거를 둠. 사소하거나 중요한 세부 사항에 관심을 두기도 하지만 공통적으로 "더 나은 소프트웨어 만들기"가 주된 목표. 코드의 품질을 고품질 혹은 저품질로 정의하는 것은 주관적일 수 있음. 따라서, 객관적으로 바라보기 위해 **코드가 달성하고자 하는 목표가 무엇인지 생각**해봐야 함. **목표를 달성하는데 도움이 되는 코드는 고품질, 방해된다면 저품질**임.

### 코드 품질의 목표

1. 코드는 작동해야 한다.
2. 코드는 작동이 멈춰서는 안 된다.
3. 변화하는 요구 사항에 적응해야 한다.
4. 이미 존재하는 기능을 또다시 구현해서는 안 된다.

#### 1. 코드는 작동해야 한다.

코드를 작성하는 이유는 문제를 해결하기 위함. 코드의 첫 번째 목표는 작성된 목적대로 동작해야 함. 코드가 작동한다는 것을 정의하기 위해선 모든 요구 사항을 파악해야 함. 요구 사항이 모두 만족되는 코드만이 작동하는 코드.

#### 2. 코드는 작동이 멈춰서는 안 된다.

코드는 고립된 환경에서 작동하는 것이 아님. 따라서 주변 상황에 영향을 받아 작동이 멈출 수 있음.

- 코드는 다른 코드에 의존할 수 있는데, 의존한 코드가 수정되고 변경될 수 있다.
- 새로운 기능이 필요할 때 코드를 수정해야 할 수 있다.
- 해결하려는 문제는 시간이 지나면 변경된다.

위와 같은 환경의 변화에 의해 코드가 변경됐을 때, 제대로 동작하지 않는 코드는 유용하지 않음. **당장 돌아가는** 코드는 작성하기 쉬움. 그러나, 변화에도 동작을 멈추지 않고 계속 동작하는 코드는 어려움. 동작의 지속성을 보장하는 것은 소프트웨어 엔지니어의 가장 큰 과제.

#### 3. 코드는 변경된 요구 사항에 적응할 수 있어야 한다.

한 번 작성되면 수정되지 않는 코드는 없음.

- 비즈니스 환경이 변한다.
- 사용자 선호가 변한다.
- 가정이 더 이상 유효하지 않다.
- 새로운 기능이 계속 추가된다.

물론, 요구 사항이 어떻게 변할지 완벽하고 정확하게 예측하는 것은 불가능함. 그렇다고 변한다는 사실을 애써 무시하는 것은 위험함. 모든 변화에 대비하여 많은 시간을 쏟는 것도 비효율적임.

중간 타협점을 찾아 적절하게 변화에 대비하고 변경에 유연한 코드를 작성해야 함.

#### 4. 코드는 이미 존재하는 기능을 중복 구현해서는 안 된다.

문제를 해결하기 위해 코드를 작성할 때, 일반적으로 큰 문제를 여러 작은 하위 문제로 나눔. 대부분의 하위 문제는 이미 많은 사람들이 해결한 상태. 따라서, 이미 존재하는 기능은 활용하는 편이 나음. 그 때의 장점은 다음과 같음.

- 시간과 노력을 절약한다.
- 버그 가능성을 줄여준다.
- 기존 전문지식을 활용한다.
- 코드가 이해하기 쉽다.

이미 있는 코드는 다시 작성하지 않는다는 개념은 양방향으로 적용됨. 하위 수준 문제를 해결하기 위해 다른 개발자가 이미 코드를 작성했다면, 그 코드를 활용해야 함. 반대로, 내가 하위 문제를 해결하기 위해 이미 코드를 작성했을 때도 다른 개발자들이 내가 작성한 코드를 쉽게 재사용하도록 코드를 구성해야 함.

### 코드 품질의 핵심 요소

코드 품질의 여섯 가지 핵심 요소는 다음과 같음.

1. 코드는 읽기 쉬워야 한다.
2. 코드는 예측 가능해야 한다.
3. 코드를 오용하기 어렵게 만들어라.
4. 코드를 모듈화하라.
5. 코드를 재사용 가능하고 일반화할 수 있게 작성하라.
6. 테스트가 용이한 코드를 작성하고, 제대로 테스트하라.

#### 1. 코드는 읽기 쉬워야 한다.

코드를 작성하고 난 후 언젠가는 다른 개발자가 그 코드를 읽고 이해해야 하는 상황이 반드시 찾아옴. 코드의 가독성이 떨어지면, 다른 개발자는 그 코드를 이해하는 데 많은 시간을 써야 함.

또한, 코드의 기능을 잘못 이해하거나 중요한 세부 사항을 놓칠 가능성도 큼. 이렇게 되면 새로운 기능을 추가하면 새로운 버그도 추가될 가능성이 큼. 가독성을 위해선 올바른 추상화 계층을 정의하거나 여러 기법을 활용할 수 있음.

#### 2. 코드는 예측 가능해야 한다.

어떤 기능을 사용할 때, 우리는 **정신 모델**(mental model)을 활용함. 예를 들어 우리가 전화를 사용할 때, 전화기의 일반적인 정신 모델은 전화를 건 번호와 연결된다고 가정함. 전화기가 전화를 건 번호와 연결시켜 주는 기능을 한다는 것은 예측하기 쉬움. 그러나, 똑똑한 전화기를 만든다는 목적으로 구현한 전화기가 일정 시간 전화를 건 번호와 연결되지 않으면 자동으로 다른 번호로 전화를 걸어주는 기능은 전혀 예측할 수도 없고 오히려 위험함.

즉, 아무리 도움이 되거나 똑똑한 일을 수행하는 획기적인 코드를 작성하더라도 예상을 벗어난 동작을 수행하면 위험한 코드임. 해당 코드를 사용하는 개발자는 예상 외의 상황을 인지하지 못하거나 대처할 생각을 하지 못할 수 있음. 따라서, 코드가 예상을 벗어나는 일을 수행하지 않도록 작성해야 함.

코드 계약에 대한 세심한 주의가 예측 가능한 코드를 작성하는데 도움이 되며, 오류를 제대로 처리하거나 여러 기술을 통해 예측 가능한 코드를 작성할 수 있음.
